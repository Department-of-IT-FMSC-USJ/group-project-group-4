<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Test Birth Certificate API</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 16px; }
    h1 { margin-bottom: 8px }
    section { border: 1px solid #ddd; padding: 12px; margin-bottom: 16px; border-radius: 6px; }
    label { display:block; margin-top:8px }
    input[type=text], input[type=number], textarea { width: 100%; padding:8px; box-sizing: border-box }
    button { margin-top: 8px; padding:8px 12px }
    pre { background:#f6f6f6; padding:12px; overflow:auto }
    .row { display:flex; gap:12px }
    .col { flex:1 }
  </style>
</head>
<body>
  <h1>Birth Certificate API Test</h1>
  <p>Open this file in a browser while your PHP server is running (or use the repo root URL). It calls <code>api/birth_certificate.php</code>.</p>

  <section id="verify-section">
    <h2>1) Verify Certificate Number</h2>
    <label>Certificate Number
      <input type="text" id="verify-number" value="BC001" />
    </label>
    <button id="verify-btn">Verify</button>
    <h4>Response</h4>
    <pre id="verify-res">(no response yet)</pre>
  </section>

  <section id="security-section">
    <h2>2) Verify Security Details</h2>
    <label>Certificate Number
      <input type="text" id="sec-number" value="BC001" />
    </label>
    <div class="row">
      <div class="col">
        <label>Place of Birth
          <input type="text" id="sec-place" value="Colombo" />
        </label>
      </div>
      <div class="col">
        <label>Father Place of Birth
          <input type="text" id="sec-father" value="Kandy" />
        </label>
      </div>
      <div class="col">
        <label>Mother Place of Birth
          <input type="text" id="sec-mother" value="Galle" />
        </label>
      </div>
    </div>
    <button id="sec-btn">Verify Security</button>
    <h4>Response</h4>
    <pre id="sec-res">(no response yet)</pre>
  </section>

  <section id="request-section">
    <h2>3) Request Copies</h2>
    <label>Certificate Number
      <input type="text" id="req-number" value="BC001" />
    </label>
    <label>Copies (1-4)
      <input type="number" id="req-quantity" min="1" max="4" value="2" />
    </label>
    <button id="req-btn">Request Copies</button>
    <h4>Response</h4>
    <pre id="req-res">(no response yet)</pre>
  </section>

  <section id="get-section">
    <h2>4) Get Certificate</h2>
    <label>Certificate Number
      <input type="text" id="get-number" value="BC001" />
    </label>
    <button id="get-btn">Get Certificate</button>
    <h4>Response</h4>
    <pre id="get-res">(no response yet)</pre>
  </section>

  <section id="link-section">
    <h2>5) Link Payment (PUT)</h2>
    <label>Certificate Number
      <input type="text" id="link-number" value="BC001" />
    </label>
    <label>Payment ID
      <input type="text" id="link-payment" value="1" />
    </label>
    <button id="link-btn">Link Payment</button>
    <h4>Response</h4>
    <pre id="link-res">(no response yet)</pre>
  </section>

  <script>
    const baseUrl = window.location.origin + window.location.pathname.replace(/\/test_birth_certificate.html$/, '') + 'api/birth_certificate.php';

    function show(el, obj) {
      document.getElementById(el).textContent = JSON.stringify(obj, null, 2);
    }

    document.getElementById('verify-btn').addEventListener('click', async () => {
      const number = document.getElementById('verify-number').value.trim();
      const url = baseUrl + '?action=verify';
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ birthCertificateNumber: number })
      });
      show('verify-res', await res.json());
    });

    document.getElementById('sec-btn').addEventListener('click', async () => {
      const payload = {
        birthCertificateNumber: document.getElementById('sec-number').value.trim(),
        placeOfBirth: document.getElementById('sec-place').value.trim(),
        fatherPlaceOfBirth: document.getElementById('sec-father').value.trim(),
        motherPlaceOfBirth: document.getElementById('sec-mother').value.trim(),
      };
      const url = baseUrl + '?action=verify-security';
      const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
      show('sec-res', await res.json());
    });

    document.getElementById('req-btn').addEventListener('click', async () => {
      const payload = {
        birthCertificateNumber: document.getElementById('req-number').value.trim(),
        copyQuantity: parseInt(document.getElementById('req-quantity').value, 10)
      };
      const url = baseUrl + '?action=request';
      const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
      show('req-res', await res.json());
    });

    document.getElementById('get-btn').addEventListener('click', async () => {
      const number = document.getElementById('get-number').value.trim();
      const url = baseUrl + '?certificate_number=' + encodeURIComponent(number);
      const res = await fetch(url);
      show('get-res', await res.json());
    });

    document.getElementById('link-btn').addEventListener('click', async () => {
      const payload = {
        certificate_number: document.getElementById('link-number').value.trim(),
        payment_id: document.getElementById('link-payment').value.trim()
      };
      // Using PUT with JSON body
      const res = await fetch(baseUrl, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
      show('link-res', await res.json());
    });

  </script>
</body>
</html>